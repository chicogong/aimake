# AIMake ä¸Šçº¿éªŒè¯æµ‹è¯•è®¡åˆ’

> åˆ›å»ºæ—¥æœŸ: 2026-01-09ç›®çš„: ç¡®ä¿æ¯æ¬¡å‘å¸ƒå‰ç³»ç»Ÿç¨³å®šå¯ç”¨

---

## ä¸€ã€éªŒè¯æµ‹è¯•ç±»å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¸Šçº¿éªŒè¯æµ‹è¯•                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   å†’çƒŸæµ‹è¯•    â”‚  â”‚   å›å½’æµ‹è¯•    â”‚  â”‚   æ€§èƒ½æµ‹è¯•    â”‚      â”‚
â”‚  â”‚  Smoke Test  â”‚  â”‚  Regression  â”‚  â”‚  Performance â”‚      â”‚
â”‚  â”‚   (5 åˆ†é’Ÿ)   â”‚  â”‚   (15 åˆ†é’Ÿ)   â”‚  â”‚   (10 åˆ†é’Ÿ)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   å®‰å…¨æµ‹è¯•    â”‚  â”‚   å…¼å®¹æ€§æµ‹è¯•  â”‚  â”‚   ç›‘æ§éªŒè¯    â”‚      â”‚
â”‚  â”‚   Security   â”‚  â”‚ Compatibilityâ”‚  â”‚  Monitoring  â”‚      â”‚
â”‚  â”‚   (5 åˆ†é’Ÿ)   â”‚  â”‚   (10 åˆ†é’Ÿ)   â”‚  â”‚   (5 åˆ†é’Ÿ)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€å†’çƒŸæµ‹è¯• (Smoke Test)

### 2.1 æ ¸å¿ƒåŠŸèƒ½æ£€æŸ¥æ¸…å•

å¿«é€ŸéªŒè¯æ ¸å¿ƒåŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œå‘ç°ä¸¥é‡é—®é¢˜ç«‹å³å›æ»šã€‚

```markdown
## å†’çƒŸæµ‹è¯•æ£€æŸ¥é¡¹ (5 åˆ†é’Ÿ)

### å‰ç«¯å¯è®¿é—®æ€§

- [ ] é¦–é¡µåŠ è½½æˆåŠŸ (< 3s)
- [ ] æ—  JS æ§åˆ¶å°é”™è¯¯
- [ ] é™æ€èµ„æºåŠ è½½æ­£å¸¸ (CSS/JS/å›¾ç‰‡)

### è®¤è¯æµç¨‹

- [ ] ç™»å½•é¡µé¢å¯è®¿é—®
- [ ] Google OAuth è·³è½¬æ­£å¸¸
- [ ] ç™»å½•åæ­£ç¡®è·³è½¬åˆ° /app
- [ ] ç™»å‡ºåŠŸèƒ½æ­£å¸¸

### æ ¸å¿ƒä¸šåŠ¡

- [ ] TTS åˆ›å»ºé¡µé¢å¯è®¿é—®
- [ ] è¾“å…¥æ–‡æœ¬åå¯é€‰æ‹©éŸ³è‰²
- [ ] ç‚¹å‡»ç”Ÿæˆå API å“åº”æ­£å¸¸
- [ ] éŸ³é¢‘æ’­æ”¾å™¨å¯æ’­æ”¾

### API å¥åº·æ£€æŸ¥

- [ ] GET /health è¿”å› 200
- [ ] GET /api/voices è¿”å›éŸ³è‰²åˆ—è¡¨
- [ ] POST /api/tts/generate å¯è°ƒç”¨
```

### 2.2 è‡ªåŠ¨åŒ–å†’çƒŸæµ‹è¯•è„šæœ¬

```typescript
// tests/smoke/smoke.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Smoke Tests', () => {
  test('homepage loads successfully', async ({ page }) => {
    const response = await page.goto('/');
    expect(response?.status()).toBe(200);

    // æ£€æŸ¥å…³é”®å…ƒç´ 
    await expect(page.locator('h1')).toBeVisible();
    await expect(page.locator('[data-testid="login-btn"]')).toBeVisible();
  });

  test('API health check', async ({ request }) => {
    const response = await request.get('/api/health');
    expect(response.status()).toBe(200);

    const data = await response.json();
    expect(data.status).toBe('ok');
    expect(data.database).toBe('connected');
  });

  test('auth flow works', async ({ page }) => {
    await page.goto('/sign-in');
    await expect(page.locator('text=ç™»å½•')).toBeVisible();
    await expect(page.locator('button:has-text("Google")')).toBeVisible();
  });

  test('TTS page accessible after login', async ({ page }) => {
    // ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•
    await page.goto('/sign-in');
    await page.fill('input[name="email"]', process.env.TEST_USER_EMAIL!);
    await page.fill('input[name="password"]', process.env.TEST_USER_PASSWORD!);
    await page.click('button[type="submit"]');

    // éªŒè¯è·³è½¬åˆ°åº”ç”¨
    await expect(page).toHaveURL('/app', { timeout: 10000 });

    // éªŒè¯åˆ›å»ºé¡µé¢
    await page.click('text=åˆ›å»º');
    await expect(page.locator('textarea')).toBeVisible();
  });
});
```

### 2.3 å†’çƒŸæµ‹è¯• CLI å‘½ä»¤

```bash
#!/bin/bash
# scripts/smoke-test.sh

echo "ğŸ”¥ è¿è¡Œå†’çƒŸæµ‹è¯•..."

BASE_URL=${1:-"https://aimake.cc"}
API_URL=${2:-"https://api.aimake.cc"}

# 1. å‰ç«¯å¥åº·æ£€æŸ¥
echo "æ£€æŸ¥å‰ç«¯..."
HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" $BASE_URL)
if [ "$HTTP_CODE" != "200" ]; then
  echo "âŒ å‰ç«¯ä¸å¯è®¿é—®: HTTP $HTTP_CODE"
  exit 1
fi
echo "âœ… å‰ç«¯æ­£å¸¸"

# 2. API å¥åº·æ£€æŸ¥
echo "æ£€æŸ¥ API..."
HEALTH=$(curl -s "$API_URL/health")
if [[ ! "$HEALTH" == *"ok"* ]]; then
  echo "âŒ API å¥åº·æ£€æŸ¥å¤±è´¥: $HEALTH"
  exit 1
fi
echo "âœ… API æ­£å¸¸"

# 3. éŸ³è‰²åˆ—è¡¨ API
echo "æ£€æŸ¥éŸ³è‰² API..."
VOICES=$(curl -s "$API_URL/api/voices")
if [[ ! "$VOICES" == *"openai"* ]]; then
  echo "âŒ éŸ³è‰² API å¼‚å¸¸"
  exit 1
fi
echo "âœ… éŸ³è‰² API æ­£å¸¸"

# 4. Playwright E2E æµ‹è¯•
echo "è¿è¡Œ E2E å†’çƒŸæµ‹è¯•..."
npx playwright test tests/smoke/ --reporter=list

echo "ğŸ‰ å†’çƒŸæµ‹è¯•é€šè¿‡ï¼"
```

---

## ä¸‰ã€å›å½’æµ‹è¯• (Regression Test)

### 3.1 æµ‹è¯•èŒƒå›´

ç¡®ä¿æ–°ç‰ˆæœ¬æ²¡æœ‰ç ´åå·²æœ‰åŠŸèƒ½ã€‚

```markdown
## å›å½’æµ‹è¯•çŸ©é˜µ

| æ¨¡å—         | æµ‹è¯•ç”¨ä¾‹             | ä¼˜å…ˆçº§ |
| ------------ | -------------------- | ------ |
| **è®¤è¯**     |                      |        |
|              | é‚®ç®±å¯†ç ç™»å½•         | P0     |
|              | Google OAuth         | P0     |
|              | GitHub OAuth         | P1     |
|              | ç™»å‡º                 | P0     |
|              | Token åˆ·æ–°           | P1     |
| **TTS ç”Ÿæˆ** |                      |        |
|              | çŸ­æ–‡æœ¬ç”Ÿæˆ (< 100å­—) | P0     |
|              | é•¿æ–‡æœ¬ç”Ÿæˆ (1000å­—)  | P0     |
|              | ä¸åŒéŸ³è‰²åˆ‡æ¢         | P0     |
|              | ç”Ÿæˆè¿›åº¦æ˜¾ç¤º         | P1     |
|              | ç”Ÿæˆå¤±è´¥é‡è¯•         | P1     |
| **éŸ³é¢‘ç®¡ç†** |                      |        |
|              | éŸ³é¢‘åˆ—è¡¨åŠ è½½         | P0     |
|              | éŸ³é¢‘æ’­æ”¾             | P0     |
|              | éŸ³é¢‘ä¸‹è½½             | P0     |
|              | éŸ³é¢‘åˆ é™¤             | P1     |
| **ç”¨æˆ·ä¸­å¿ƒ** |                      |        |
|              | ç”¨é‡æ˜¾ç¤º             | P0     |
|              | é¢åº¦æé†’             | P1     |
|              | è®¢é˜…ä¿¡æ¯             | P1     |
```

### 3.2 è‡ªåŠ¨åŒ–å›å½’æµ‹è¯•

```typescript
// tests/regression/auth.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Auth Regression', () => {
  test('email login flow', async ({ page }) => {
    await page.goto('/sign-in');

    await page.fill('input[name="email"]', 'test@example.com');
    await page.fill('input[name="password"]', 'TestPass123!');
    await page.click('button[type="submit"]');

    await expect(page).toHaveURL('/app');
    await expect(page.locator('[data-testid="user-button"]')).toBeVisible();
  });

  test('logout clears session', async ({ page }) => {
    // å…ˆç™»å½•
    await loginAsTestUser(page);

    // ç™»å‡º
    await page.click('[data-testid="user-button"]');
    await page.click('text=é€€å‡ºç™»å½•');

    // éªŒè¯è·³è½¬åˆ°é¦–é¡µ
    await expect(page).toHaveURL('/');

    // éªŒè¯æ— æ³•è®¿é—®å—ä¿æŠ¤é¡µé¢
    await page.goto('/app');
    await expect(page).toHaveURL('/sign-in');
  });
});

// tests/regression/tts.spec.ts
test.describe('TTS Regression', () => {
  test.beforeEach(async ({ page }) => {
    await loginAsTestUser(page);
  });

  test('generate short text audio', async ({ page }) => {
    await page.goto('/app/create');

    await page.fill('textarea', 'è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬ã€‚');
    await page.click('[data-voice-id="openai-alloy"]');
    await page.click('button:has-text("ç”Ÿæˆ")');

    // ç­‰å¾…ç”Ÿæˆå®Œæˆ
    await expect(page.locator('.audio-player')).toBeVisible({ timeout: 30000 });

    // éªŒè¯å¯ä»¥æ’­æ”¾
    await page.click('[aria-label="æ’­æ”¾"]');
    await expect(page.locator('[aria-label="æš‚åœ"]')).toBeVisible();
  });

  test('generate long text audio', async ({ page }) => {
    await page.goto('/app/create');

    const longText = 'è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æµ‹è¯•æ–‡æœ¬ã€‚'.repeat(50);
    await page.fill('textarea', longText);
    await page.click('[data-voice-id="openai-nova"]');
    await page.click('button:has-text("ç”Ÿæˆ")');

    // é•¿æ–‡æœ¬éœ€è¦æ›´é•¿æ—¶é—´
    await expect(page.locator('.audio-player')).toBeVisible({ timeout: 60000 });
  });

  test('switch voice before generate', async ({ page }) => {
    await page.goto('/app/create');

    await page.fill('textarea', 'æµ‹è¯•éŸ³è‰²åˆ‡æ¢ã€‚');

    // é€‰æ‹©ç¬¬ä¸€ä¸ªéŸ³è‰²
    await page.click('[data-voice-id="openai-alloy"]');
    await expect(page.locator('[data-voice-id="openai-alloy"]')).toHaveClass(/selected/);

    // åˆ‡æ¢åˆ°å¦ä¸€ä¸ªéŸ³è‰²
    await page.click('[data-voice-id="openai-echo"]');
    await expect(page.locator('[data-voice-id="openai-echo"]')).toHaveClass(/selected/);
    await expect(page.locator('[data-voice-id="openai-alloy"]')).not.toHaveClass(/selected/);
  });
});
```

### 3.3 GitHub Actions å›å½’æµ‹è¯•

```yaml
# .github/workflows/regression.yml
name: Regression Tests

on:
  deployment_status:

jobs:
  regression:
    if: github.event.deployment_status.state == 'success'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright
        run: npx playwright install --with-deps chromium

      - name: Run regression tests
        run: npx playwright test tests/regression/
        env:
          BASE_URL: ${{ github.event.deployment_status.target_url }}
          TEST_USER_EMAIL: ${{ secrets.TEST_USER_EMAIL }}
          TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}

      - name: Upload test report
        uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: regression-report
          path: playwright-report/
```

---

## å››ã€æ€§èƒ½æµ‹è¯•

### 4.1 æ€§èƒ½æŒ‡æ ‡

```markdown
## æ€§èƒ½ SLA

| æŒ‡æ ‡              | ç›®æ ‡å€¼  | å‘Šè­¦é˜ˆå€¼ |
| ----------------- | ------- | -------- |
| **å‰ç«¯**          |         |          |
| é¦–é¡µ LCP          | < 2.5s  | > 4s     |
| FID               | < 100ms | > 300ms  |
| CLS               | < 0.1   | > 0.25   |
| **API**           |         |          |
| /health å“åº”      | < 50ms  | > 200ms  |
| /api/voices       | < 100ms | > 500ms  |
| /api/tts/generate | < 30s   | > 60s    |
| **èµ„æº**          |         |          |
| JS Bundle         | < 200KB | > 500KB  |
| é¦–é¡µæ€»å¤§å°        | < 1MB   | > 2MB    |
```

### 4.2 æ€§èƒ½æµ‹è¯•è„šæœ¬

```typescript
// tests/performance/perf.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Performance Tests', () => {
  test('homepage Core Web Vitals', async ({ page }) => {
    await page.goto('/');

    // è·å– Web Vitals
    const metrics = await page.evaluate(() => {
      return new Promise((resolve) => {
        const results: Record<string, number> = {};

        new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (entry.entryType === 'largest-contentful-paint') {
              results.lcp = entry.startTime;
            }
          }
        }).observe({ type: 'largest-contentful-paint', buffered: true });

        // CLS
        let cls = 0;
        new PerformanceObserver((list) => {
          for (const entry of list.getEntries() as any[]) {
            if (!entry.hadRecentInput) {
              cls += entry.value;
            }
          }
          results.cls = cls;
        }).observe({ type: 'layout-shift', buffered: true });

        setTimeout(() => resolve(results), 3000);
      });
    });

    console.log('Web Vitals:', metrics);
    expect(metrics.lcp).toBeLessThan(2500);
    expect(metrics.cls).toBeLessThan(0.1);
  });

  test('API response times', async ({ request }) => {
    // Health endpoint
    const healthStart = Date.now();
    await request.get('/api/health');
    const healthTime = Date.now() - healthStart;
    expect(healthTime).toBeLessThan(200);

    // Voices endpoint
    const voicesStart = Date.now();
    await request.get('/api/voices');
    const voicesTime = Date.now() - voicesStart;
    expect(voicesTime).toBeLessThan(500);
  });

  test('bundle size check', async ({ page }) => {
    const resources: { name: string; size: number }[] = [];

    page.on('response', async (response) => {
      const url = response.url();
      if (url.includes('.js') || url.includes('.css')) {
        const buffer = await response.body();
        resources.push({
          name: url.split('/').pop() || url,
          size: buffer.length,
        });
      }
    });

    await page.goto('/');
    await page.waitForLoadState('networkidle');

    const totalJS = resources
      .filter((r) => r.name.endsWith('.js'))
      .reduce((sum, r) => sum + r.size, 0);

    console.log('Total JS size:', (totalJS / 1024).toFixed(2), 'KB');
    expect(totalJS).toBeLessThan(500 * 1024); // 500KB
  });
});
```

### 4.3 è´Ÿè½½æµ‹è¯• (k6)

```javascript
// tests/load/api-load.js
import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = {
  stages: [
    { duration: '1m', target: 10 }, // Ramp up
    { duration: '3m', target: 10 }, // Stay
    { duration: '1m', target: 0 }, // Ramp down
  ],
  thresholds: {
    http_req_duration: ['p(95)<500'],
    http_req_failed: ['rate<0.01'],
  },
};

export default function () {
  // Health check
  const healthRes = http.get('https://api.aimake.cc/health');
  check(healthRes, {
    'health status 200': (r) => r.status === 200,
    'health response < 200ms': (r) => r.timings.duration < 200,
  });

  // Voices list
  const voicesRes = http.get('https://api.aimake.cc/api/voices');
  check(voicesRes, {
    'voices status 200': (r) => r.status === 200,
    'voices response < 500ms': (r) => r.timings.duration < 500,
  });

  sleep(1);
}
```

---

## äº”ã€å®‰å…¨æµ‹è¯•

### 5.1 å®‰å…¨æ£€æŸ¥æ¸…å•

```markdown
## å®‰å…¨éªŒè¯é¡¹

### è®¤è¯å®‰å…¨

- [ ] æ— æ•ˆ Token è¿”å› 401
- [ ] è¿‡æœŸ Token è¿”å› 401
- [ ] æ—  Token è®¿é—®å—ä¿æŠ¤è·¯ç”±è¿”å› 401
- [ ] CORS é…ç½®æ­£ç¡®

### è¾“å…¥éªŒè¯

- [ ] XSS é˜²æŠ¤ (HTML è½¬ä¹‰)
- [ ] SQL æ³¨å…¥é˜²æŠ¤
- [ ] æ–‡æœ¬é•¿åº¦é™åˆ¶ç”Ÿæ•ˆ
- [ ] æ–‡ä»¶ä¸Šä¼ ç±»å‹é™åˆ¶

### é€Ÿç‡é™åˆ¶

- [ ] API é€Ÿç‡é™åˆ¶ç”Ÿæ•ˆ
- [ ] è¶…é™è¿”å› 429
- [ ] é™åˆ¶é‡ç½®æ­£å¸¸

### æ•æ„Ÿä¿¡æ¯

- [ ] é”™è¯¯å“åº”ä¸æ³„éœ²å †æ ˆ
- [ ] æ—¥å¿—ä¸è®°å½•æ•æ„Ÿä¿¡æ¯
- [ ] API Key ä¸æš´éœ²åœ¨å‰ç«¯
```

### 5.2 è‡ªåŠ¨åŒ–å®‰å…¨æµ‹è¯•

```typescript
// tests/security/security.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Security Tests', () => {
  test('protected routes require auth', async ({ request }) => {
    const response = await request.get('/api/user/profile');
    expect(response.status()).toBe(401);
  });

  test('invalid token rejected', async ({ request }) => {
    const response = await request.get('/api/user/profile', {
      headers: {
        Authorization: 'Bearer invalid-token-here',
      },
    });
    expect(response.status()).toBe(401);
  });

  test('XSS prevention', async ({ page }) => {
    await loginAsTestUser(page);
    await page.goto('/app/create');

    // å°è¯• XSS æ”»å‡»
    const xssPayload = '<script>alert("xss")</script>';
    await page.fill('textarea', xssPayload);
    await page.click('button:has-text("ç”Ÿæˆ")');

    // éªŒè¯è„šæœ¬æœªæ‰§è¡Œ
    const alertTriggered = await page.evaluate(() => {
      return (window as any).__xssTriggered || false;
    });
    expect(alertTriggered).toBe(false);
  });

  test('rate limiting works', async ({ request }) => {
    // å¿«é€Ÿå‘é€å¤šä¸ªè¯·æ±‚
    const requests = Array(20)
      .fill(null)
      .map(() => request.get('/api/voices'));

    const responses = await Promise.all(requests);
    const tooManyRequests = responses.filter((r) => r.status() === 429);

    // åº”è¯¥æœ‰éƒ¨åˆ†è¯·æ±‚è¢«é™åˆ¶
    expect(tooManyRequests.length).toBeGreaterThan(0);
  });

  test('CORS headers correct', async ({ request }) => {
    const response = await request.get('/api/health', {
      headers: {
        Origin: 'https://malicious-site.com',
      },
    });

    const corsHeader = response.headers()['access-control-allow-origin'];
    expect(corsHeader).not.toBe('*');
    expect(corsHeader).not.toBe('https://malicious-site.com');
  });
});
```

---

## å…­ã€å…¼å®¹æ€§æµ‹è¯•

### 6.1 æµè§ˆå™¨å…¼å®¹æ€§

```markdown
## æ”¯æŒçš„æµè§ˆå™¨

| æµè§ˆå™¨         | ç‰ˆæœ¬          | ä¼˜å…ˆçº§ |
| -------------- | ------------- | ------ |
| Chrome         | æœ€æ–° 2 ä¸ªç‰ˆæœ¬ | P0     |
| Safari         | æœ€æ–° 2 ä¸ªç‰ˆæœ¬ | P0     |
| Firefox        | æœ€æ–° 2 ä¸ªç‰ˆæœ¬ | P1     |
| Edge           | æœ€æ–° 2 ä¸ªç‰ˆæœ¬ | P1     |
| Safari iOS     | æœ€æ–° 2 ä¸ªç‰ˆæœ¬ | P0     |
| Chrome Android | æœ€æ–° 2 ä¸ªç‰ˆæœ¬ | P1     |
```

### 6.2 Playwright å¤šæµè§ˆå™¨æµ‹è¯•

```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
    {
      name: 'Mobile Safari',
      use: { ...devices['iPhone 12'] },
    },
  ],
});
```

### 6.3 å“åº”å¼æµ‹è¯•

```typescript
// tests/compatibility/responsive.spec.ts
import { test, expect } from '@playwright/test';

const viewports = [
  { name: 'mobile', width: 375, height: 667 },
  { name: 'tablet', width: 768, height: 1024 },
  { name: 'desktop', width: 1440, height: 900 },
];

for (const viewport of viewports) {
  test(`homepage renders correctly on ${viewport.name}`, async ({ page }) => {
    await page.setViewportSize({
      width: viewport.width,
      height: viewport.height,
    });

    await page.goto('/');

    // æˆªå›¾å¯¹æ¯”
    await expect(page).toHaveScreenshot(`homepage-${viewport.name}.png`);

    // éªŒè¯å…³é”®å…ƒç´ å¯è§
    await expect(page.locator('nav')).toBeVisible();
    await expect(page.locator('h1')).toBeVisible();
    await expect(page.locator('[data-testid="cta-button"]')).toBeVisible();
  });
}
```

---

## ä¸ƒã€ç›‘æ§éªŒè¯

### 7.1 ç›‘æ§æ£€æŸ¥æ¸…å•

```markdown
## ä¸Šçº¿åç›‘æ§éªŒè¯

### Sentry é”™è¯¯ç›‘æ§

- [ ] æµ‹è¯•é”™è¯¯èƒ½å¤Ÿä¸ŠæŠ¥
- [ ] Source Map æ­£ç¡®è§£æ
- [ ] å‘Šè­¦é€šçŸ¥æ­£å¸¸

### Vercel Analytics

- [ ] é¡µé¢è®¿é—®è®°å½•æ­£å¸¸
- [ ] Core Web Vitals é‡‡é›†æ­£å¸¸
- [ ] å®æ—¶æ•°æ®æ›´æ–°

### Cloudflare Analytics

- [ ] è¯·æ±‚ç»Ÿè®¡æ­£å¸¸
- [ ] é”™è¯¯ç‡æ˜¾ç¤ºæ­£å¸¸
- [ ] åœ°ç†åˆ†å¸ƒæ­£å¸¸

### UptimeRobot

- [ ] ç›‘æ§å™¨çŠ¶æ€ä¸º Up
- [ ] å“åº”æ—¶é—´è®°å½•æ­£å¸¸
- [ ] å‘Šè­¦é…ç½®ç”Ÿæ•ˆ
```

### 7.2 ç›‘æ§éªŒè¯è„šæœ¬

```bash
#!/bin/bash
# scripts/verify-monitoring.sh

echo "ğŸ“Š éªŒè¯ç›‘æ§é…ç½®..."

# 1. è§¦å‘æµ‹è¯•é”™è¯¯ (éªŒè¯ Sentry)
echo "è§¦å‘ Sentry æµ‹è¯•é”™è¯¯..."
curl -X POST "https://api.aimake.cc/api/test/error" \
  -H "X-Test-Key: $TEST_API_KEY"

echo "ç­‰å¾… Sentry æ¥æ”¶..."
sleep 10

# æ£€æŸ¥ Sentry æ˜¯å¦æ”¶åˆ°
SENTRY_ISSUES=$(curl -s "https://sentry.io/api/0/projects/aimake/aimake/issues/" \
  -H "Authorization: Bearer $SENTRY_TOKEN" | jq '.[] | select(.title | contains("Test Error"))')

if [ -n "$SENTRY_ISSUES" ]; then
  echo "âœ… Sentry ç›‘æ§æ­£å¸¸"
else
  echo "âŒ Sentry æœªæ”¶åˆ°æµ‹è¯•é”™è¯¯"
fi

# 2. éªŒè¯ UptimeRobot
echo "æ£€æŸ¥ UptimeRobot çŠ¶æ€..."
UPTIME_STATUS=$(curl -s "https://api.uptimerobot.com/v2/getMonitors" \
  -d "api_key=$UPTIME_ROBOT_KEY" \
  -d "format=json" | jq '.monitors[] | select(.friendly_name == "AIMake") | .status')

if [ "$UPTIME_STATUS" == "2" ]; then
  echo "âœ… UptimeRobot ç›‘æ§æ­£å¸¸ (çŠ¶æ€: Up)"
else
  echo "âŒ UptimeRobot çŠ¶æ€å¼‚å¸¸: $UPTIME_STATUS"
fi

echo "ğŸ“Š ç›‘æ§éªŒè¯å®Œæˆ"
```

---

## å…«ã€ä¸Šçº¿æµç¨‹

### 8.1 å‘å¸ƒå‰æ£€æŸ¥

```markdown
## å‘å¸ƒå‰æ£€æŸ¥æ¸…å• (Release Checklist)

### ä»£ç å‡†å¤‡

- [ ] æ‰€æœ‰ PR å·²åˆå¹¶åˆ° main
- [ ] ç‰ˆæœ¬å·å·²æ›´æ–° (package.json)
- [ ] CHANGELOG å·²æ›´æ–°
- [ ] æ— æœªè§£å†³çš„ Critical/High Bug

### æµ‹è¯•é€šè¿‡

- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ (> 80% è¦†ç›–ç‡)
- [ ] E2E æµ‹è¯•é€šè¿‡
- [ ] å†’çƒŸæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡

### ç¯å¢ƒå‡†å¤‡

- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] Secrets å·²æ›´æ–° (å¦‚æœ‰å˜åŒ–)
- [ ] æ•°æ®åº“è¿ç§»å·²å‡†å¤‡
- [ ] CDN ç¼“å­˜ç­–ç•¥ç¡®è®¤

### å›¢é˜Ÿç¡®è®¤

- [ ] äº§å“ç¡®è®¤å‘å¸ƒèŒƒå›´
- [ ] å¼€å‘ç¡®è®¤ä»£ç å°±ç»ª
- [ ] è¿ç»´ç¡®è®¤éƒ¨ç½²å°±ç»ª
```

### 8.2 å‘å¸ƒæ­¥éª¤

```bash
#!/bin/bash
# scripts/release.sh

set -e  # é‡é”™å³åœ

VERSION=$1

if [ -z "$VERSION" ]; then
  echo "Usage: ./release.sh <version>"
  echo "Example: ./release.sh 1.0.0"
  exit 1
fi

echo "ğŸš€ å¼€å§‹å‘å¸ƒ v$VERSION"

# 1. é¢„æ£€æŸ¥
echo "Step 1: è¿è¡Œé¢„æ£€æŸ¥..."
npm run lint
npm run test

# 2. åˆ›å»ºå‘å¸ƒåˆ†æ”¯
echo "Step 2: åˆ›å»ºå‘å¸ƒåˆ†æ”¯..."
git checkout -b "release/v$VERSION"

# 3. æ›´æ–°ç‰ˆæœ¬å·
echo "Step 3: æ›´æ–°ç‰ˆæœ¬å·..."
npm version $VERSION --no-git-tag-version
git add package.json package-lock.json
git commit -m "chore: bump version to $VERSION"

# 4. åˆå¹¶åˆ° main
echo "Step 4: åˆå¹¶åˆ° main..."
git checkout main
git merge "release/v$VERSION"

# 5. æ‰“æ ‡ç­¾
echo "Step 5: åˆ›å»º Git Tag..."
git tag -a "v$VERSION" -m "Release v$VERSION"

# 6. æ¨é€
echo "Step 6: æ¨é€åˆ°è¿œç¨‹..."
git push origin main
git push origin "v$VERSION"

# 7. ç­‰å¾…éƒ¨ç½²
echo "Step 7: ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²..."
sleep 60

# 8. è¿è¡Œå†’çƒŸæµ‹è¯•
echo "Step 8: è¿è¡Œå†’çƒŸæµ‹è¯•..."
./scripts/smoke-test.sh

# 9. éªŒè¯ç›‘æ§
echo "Step 9: éªŒè¯ç›‘æ§..."
./scripts/verify-monitoring.sh

echo "ğŸ‰ v$VERSION å‘å¸ƒæˆåŠŸï¼"
echo "å‰ç«¯: https://aimake.cc"
echo "API: https://api.aimake.cc"
```

### 8.3 å›æ»šæµç¨‹

```bash
#!/bin/bash
# scripts/rollback.sh

PREVIOUS_VERSION=$1

if [ -z "$PREVIOUS_VERSION" ]; then
  echo "Usage: ./rollback.sh <previous-version>"
  echo "Example: ./rollback.sh 0.9.0"
  exit 1
fi

echo "âš ï¸ å¼€å§‹å›æ»šåˆ° v$PREVIOUS_VERSION"

# 1. é€šçŸ¥å›¢é˜Ÿ
echo "å‘é€å›æ»šé€šçŸ¥..."
curl -X POST "$SLACK_WEBHOOK" \
  -H "Content-Type: application/json" \
  -d "{\"text\": \"ğŸš¨ AIMake æ­£åœ¨å›æ»šåˆ° v$PREVIOUS_VERSION\"}"

# 2. Vercel å›æ»š
echo "å›æ»š Vercel éƒ¨ç½²..."
vercel rollback --yes

# 3. Cloudflare Workers å›æ»š
echo "å›æ»š Cloudflare Workers..."
cd api
npx wrangler rollback

# 4. éªŒè¯å›æ»š
echo "éªŒè¯å›æ»š..."
./scripts/smoke-test.sh

echo "âœ… å›æ»šå®Œæˆ"
```

---

## ä¹ã€GitHub Actions å®Œæ•´é…ç½®

```yaml
# .github/workflows/release-verification.yml
name: Release Verification

on:
  push:
    tags:
      - 'v*'

jobs:
  smoke-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Wait for deployment
        run: sleep 120

      - name: Install Playwright
        run: npx playwright install --with-deps chromium

      - name: Run smoke tests
        run: npx playwright test tests/smoke/
        env:
          BASE_URL: https://aimake.cc
          API_URL: https://api.aimake.cc

      - name: Notify success
        if: success()
        run: |
          curl -X POST "${{ secrets.SLACK_WEBHOOK }}" \
            -H "Content-Type: application/json" \
            -d '{"text": "âœ… Release ${{ github.ref_name }} smoke tests passed!"}'

      - name: Notify failure
        if: failure()
        run: |
          curl -X POST "${{ secrets.SLACK_WEBHOOK }}" \
            -H "Content-Type: application/json" \
            -d '{"text": "âŒ Release ${{ github.ref_name }} smoke tests FAILED! Check immediately."}'

  regression-test:
    needs: smoke-test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Playwright
        run: npx playwright install --with-deps

      - name: Run regression tests
        run: npx playwright test tests/regression/
        env:
          BASE_URL: https://aimake.cc
          TEST_USER_EMAIL: ${{ secrets.TEST_USER_EMAIL }}
          TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}

  performance-test:
    needs: smoke-test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run Lighthouse
        uses: treosh/lighthouse-ci-action@v10
        with:
          urls: |
            https://aimake.cc
            https://aimake.cc/sign-in
          configPath: .lighthouserc.json
          uploadArtifacts: true

  security-test:
    needs: smoke-test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Playwright
        run: npx playwright install --with-deps chromium

      - name: Run security tests
        run: npx playwright test tests/security/
        env:
          BASE_URL: https://aimake.cc
          API_URL: https://api.aimake.cc
```

---

## åã€éªŒè¯æµ‹è¯•æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸Šçº¿éªŒè¯æµ‹è¯•æµç¨‹                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ä»£ç åˆå¹¶ â†’ è‡ªåŠ¨éƒ¨ç½² â†’ å†’çƒŸæµ‹è¯• â†’ å›å½’æµ‹è¯• â†’ æ€§èƒ½æµ‹è¯• â†’ å®‰å…¨æµ‹è¯•       â”‚
â”‚                            â”‚                                         â”‚
â”‚                            â–¼                                         â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                       â”‚ é€šè¿‡ï¼Ÿ  â”‚                                    â”‚
â”‚                       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                    â”‚
â”‚                            â”‚                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚ Yes         â”‚             â”‚ No                        â”‚
â”‚              â–¼             â”‚             â–¼                           â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚        â”‚  å‘å¸ƒ    â”‚        â”‚       â”‚  å›æ»š    â”‚                      â”‚
â”‚        â”‚  å®Œæˆ    â”‚        â”‚       â”‚  ä¿®å¤    â”‚                      â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                            â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€»è€—æ—¶: çº¦ 50 åˆ†é’Ÿ
- å†’çƒŸæµ‹è¯•: 5 åˆ†é’Ÿ
- å›å½’æµ‹è¯•: 15 åˆ†é’Ÿ
- æ€§èƒ½æµ‹è¯•: 10 åˆ†é’Ÿ
- å®‰å…¨æµ‹è¯•: 5 åˆ†é’Ÿ
- å…¼å®¹æ€§æµ‹è¯•: 10 åˆ†é’Ÿ
- ç›‘æ§éªŒè¯: 5 åˆ†é’Ÿ
```

---

_ç¡®ä¿æ¯æ¬¡å‘å¸ƒéƒ½ç»è¿‡å®Œæ•´éªŒè¯ï¼_
